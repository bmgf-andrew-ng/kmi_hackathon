---
name: review-architecture
description: Reviews a solution architecture using the architect-reviewer agent. Takes a generated prompt from the Architecture Review Playground (or pasted text), runs it through a specialised architecture review agent, and outputs a structured improvement plan with technology stack recommendations optimised for local development with .devcontainer and Docker.
argument-hint: Paste the architecture review prompt from the playground
---

# Architecture Review Skill

Review a solution architecture and get a structured improvement plan with technology recommendations.

## Workflow

### Step 1 — Receive the Architecture Prompt

The user provides the review prompt via `$ARGUMENTS`. This prompt is typically generated by the Architecture Review Playground (`architecture/architecture-review-playground.html`) and contains:
- Architecture description with identified components and relationships
- Annotated problem areas with severity levels and comments
- Component linkages between annotations and detected components

If `$ARGUMENTS` is empty, ask the user to paste their architecture review prompt or point to a file containing it.

### Step 1.5 — Derive the System Name

Extract a short system name from the architecture prompt to use for file naming. Look for:
- A title like "solution architecture for X" or "Architecture Overview for X"
- The first heading or project name mentioned
- If unclear, use the dominant service/product name

Convert it to kebab-case for the filename. Examples:
- "Claude Plugin for accelerating development" → `claude-plugin-dev`
- "E-Commerce Order Platform" → `e-commerce-order-platform`
- "Multi-Tenant SaaS Portfolio Manager" → `multi-tenant-saas-portfolio`

Store this as `SYSTEM_NAME` for use in later steps.

### Step 2 — Launch the Architect Reviewer Agent

Spawn the `architect-reviewer` agent using the Task tool with the following prompt structure:

```
You are reviewing a solution architecture. Here is the review prompt generated from the Architecture Review Playground:

---
${ARGUMENTS}
---

Please perform a full architecture review following your review process:
1. Assess against Well-Architected Framework pillars
2. Recommend technology stack for every component (production + local dev with .devcontainer/Docker)
3. Address each annotated issue with diagnosis and resolution
4. Produce a phased improvement roadmap
5. Provide a revised Mermaid architecture diagram (graph TB) showing the improved design with all new and existing components

Ensure every component has a concrete local development equivalent using Docker Compose and VS Code Dev Containers.

IMPORTANT: Your response MUST include a section titled "## Revised Architecture Diagram" containing a valid Mermaid diagram using `graph TB` syntax. The diagram should:
- Group components into subgraphs by tier (Presentation, Application/Orchestration, Data)
- Show all components with their Docker image and port info in the label
- Show all relationships with descriptive edge labels
- Use classDef to colour-code: green for new components, blue for existing, orange for data stores
- Use \n for line breaks in node labels (not <br/>)
```

Use `subagent_type: "general-purpose"` for the Task tool so the agent has full access to search the web for current Docker images and technology recommendations.

### Step 3 — Present the Structured Output

Once the agent returns, present the results to the user in this order:

1. **Architecture Review Summary** — overall health assessment
2. **Well-Architected Scorecard** — pillar-by-pillar rating
3. **Component Technology Map** — table of every component with production tech and local dev Docker equivalent
4. **Issue Resolutions** — each playground annotation addressed with diagnosis and fix
5. **Recommended .devcontainer Setup** — practical `devcontainer.json` and `docker-compose.yml` outline
6. **Improvement Roadmap** — phased action plan (Critical → Structural → Optimisation)

### Step 4 — Generate the Architecture Diagram HTML

Extract the Mermaid diagram from the agent's response (the content inside the ```mermaid code fence under "## Revised Architecture Diagram").

Write an HTML file to `architecture/{SYSTEM_NAME}-architecture.html` using this template:

```html
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Revised Architecture — {SYSTEM_TITLE}</title>
<style>
  * { margin: 0; padding: 0; box-sizing: border-box; }
  body {
    background: #0d1117;
    color: #c9d1d9;
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif;
    padding: 24px;
  }
  h1 { font-size: 1.4rem; margin-bottom: 8px; color: #e6edf3; }
  .subtitle { font-size: 0.9rem; color: #8b949e; margin-bottom: 24px; }
  .diagram-container {
    background: #161b22;
    border: 1px solid #30363d;
    border-radius: 8px;
    padding: 24px;
    overflow-x: auto;
  }
  .legend {
    margin-top: 20px;
    display: flex;
    gap: 20px;
    flex-wrap: wrap;
    font-size: 0.85rem;
  }
  .legend-item { display: flex; align-items: center; gap: 6px; }
  .legend-swatch { width: 14px; height: 14px; border-radius: 3px; }
  .swatch-new { background: #2ecc71; }
  .swatch-existing { background: #3498db; }
  .swatch-data { background: #f39c12; }
</style>
</head>
<body>
<h1>Revised Architecture — {SYSTEM_TITLE}</h1>
<p class="subtitle">Generated by /review-architecture on {DATE}</p>
<div class="diagram-container">
  <pre class="mermaid">
{MERMAID_CONTENT}
  </pre>
</div>
<div class="legend">
  <div class="legend-item"><span class="legend-swatch swatch-new"></span> New components</div>
  <div class="legend-item"><span class="legend-swatch swatch-existing"></span> Existing components</div>
  <div class="legend-item"><span class="legend-swatch swatch-data"></span> Data stores</div>
</div>
<script type="module">
  import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@11/dist/mermaid.esm.min.mjs';
  mermaid.initialize({
    startOnLoad: true,
    theme: 'dark',
    themeVariables: {
      darkMode: true,
      background: '#161b22',
      primaryColor: '#1f6feb',
      primaryTextColor: '#e6edf3',
      primaryBorderColor: '#388bfd',
      lineColor: '#8b949e',
      secondaryColor: '#238636',
      tertiaryColor: '#21262d',
      fontSize: '14px'
    },
    flowchart: { htmlLabels: true, curve: 'basis', padding: 15, nodeSpacing: 40, rankSpacing: 60 }
  });
</script>
</body>
</html>
```

Replace:
- `{SYSTEM_TITLE}` with the human-readable system name
- `{SYSTEM_NAME}` with the kebab-case filename
- `{DATE}` with today's date
- `{MERMAID_CONTENT}` with the Mermaid diagram extracted from the agent's response

After writing the file, you MUST ALWAYS open it in the user's default browser by running:

```bash
open architecture/{SYSTEM_NAME}-architecture.html
```

This is not optional — every execution of this skill must end with the diagram visible in the browser. Do not ask the user if they want to open it; just open it.

### Step 5 — Offer Next Steps

After presenting the review and opening the diagram, offer the user:
- Generate the `.devcontainer/` configuration files for the project
- Create an architecture decision record (ADR) for key recommendations
- Build out the `docker-compose.yml` with all recommended local services
- Create a new architecture diagram prompt incorporating the improvements

## Example Usage

```
/review-architecture

## Architecture Overview

The system consists of:
- **API Gateway** (AWS API Gateway) — entry point for all client requests
- **Auth Service** (AWS Cognito) — handles authentication and JWT tokens
- **Order Service** (AWS Lambda + Node.js) — processes orders
- **Database** (Amazon RDS PostgreSQL) — primary data store
- **Cache** (ElastiCache Redis) — session and query cache
- **Message Queue** (Amazon SQS) — async order processing

## Relationships
- API Gateway → Auth Service (authentication)
- API Gateway → Order Service (request routing)
- Order Service → Database (read/write)
- Order Service → Cache (read-through)
- Order Service → Message Queue (async events)

## Annotations

1. **API Gateway, Auth Service** — Critical
   No rate limiting or WAF configured. Vulnerable to abuse.

2. **Order Service** — Warning
   Single Lambda handles all order operations. Should be decomposed.

3. **Database** — Info
   No read replica configured. Could improve read performance.
```

## Notes

- The skill works best with prompts generated from the Architecture Review Playground, but any pasted architecture description works
- The agent will search the web for current Docker image versions and best practices
- All local dev recommendations target VS Code Dev Containers with Docker Compose
- The review is opinionated by design — it picks one recommendation per component rather than listing alternatives
