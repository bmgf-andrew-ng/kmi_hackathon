# Architecture Review: Claude Plugin for Accelerating Development

> Generated by `/review-architecture` on 2026-02-27

## Summary

A three-store RAG architecture where Claude accesses Neo4j (graph), Azure AI Search (text/vector), and Azure Blob Storage (images) through a central MCP server. Solid retrieval foundation, but missing a presentation layer, auth, local dev story, and plugin template pattern for scaling to multiple review topics.

## Well-Architected Scorecard

| Pillar | Rating | Key Finding |
|--------|--------|-------------|
| Security | **Critical Gap** | No AuthN/AuthZ — any user can query the entire strategy corpus |
| Reliability | **Needs Attention** | Single monolithic MCP server is a single point of failure |
| Performance | **Adequate** | BM25 + vector + RRF hybrid search is best-in-class |
| Operational Excellence | **Needs Attention** | No local dev stack, no observability |
| Cost Optimisation | **Adequate** | Appropriate service choices |
| Developer Experience | **Critical Gap** | No devcontainer, no plugin template for new topics |

## Component Technology Map

| Component | Production | Local Dev (Docker) | Status |
|-----------|-----------|-------------------|--------|
| Web UI | Next.js 15 on Azure Container Apps | `node:22-alpine` (port 3000) | **New** |
| Auth Service | Keycloak 26 on Azure Container Apps | `quay.io/keycloak/keycloak:26.0` (port 8080) | **New** |
| Claude | Anthropic API (claude-opus-4-0-20250115) | Claude Code CLI | Existing |
| Strategy Review MCP Server | Python FastMCP (stdio/SSE) | stdio process in devcontainer | Existing (refactored) |
| Neo4j MCP Server | `@neo4j/mcp-neo4j` (stdio) | `npx -y @neo4j/mcp-neo4j` | **New** |
| Neo4j | Neo4j Aura Professional | `neo4j:5.26-community` (ports 7474, 7687) | Existing |
| Azure AI Search | Azure AI Search (S1) | `opensearchproject/opensearch:2.17.0` (port 9200) | Existing |
| Blob Storage | Azure Blob Storage | `mcr.microsoft.com/azure-storage/azurite:3.33.0` (port 10000) | Existing |

## Issue Resolutions

### Issue #1: No Presentation Layer — Critical

- **Problem:** End-users interact directly with Claude CLI. No auth, no audit trail, no guided experience.
- **Fix:** Add Next.js 15 web app with Keycloak 26 OIDC integration. API keys stay server-side. Role-based access controls which review topics each user can invoke (strategy-reviewer, budget-analyst, gender-tech-lead).

### Issue #2: Plugin Template for Review Topics — Suggestion

- **Problem:** Single MCP server handles all review topics. Adding a new topic means modifying server code.
- **Fix:** Claude Code plugin template pattern. Each topic is a SKILL.md + shared sub-agents:
  ```
  .claude/skills/strategy-review/SKILL.md
  .claude/skills/gender-tech-review/SKILL.md
  .claude/skills/budget-review/SKILL.md
  .claude/agents/graph-traversal.md    (shared)
  .claude/agents/document-search.md    (shared)
  .claude/agents/image-retrieval.md    (shared)
  ```
  New review topic = new markdown file. No infrastructure changes.

### Issue #4: Neo4j MCP Integration — Observation

- **Problem:** How to leverage MCP, sub-agents, etc. for Neo4j interaction.
- **Fix:** Deploy `@neo4j/mcp-neo4j` as a dedicated stdio MCP server. Create a `graph-traversal` sub-agent that uses its tools (`query`, `get_schema`). Skills dispatch to this agent via the Task tool for all graph operations.

### Issues #5–7: Local Docker Equivalents — Observation

| Cloud Service | Local Substitute | Notes |
|---------------|-----------------|-------|
| Neo4j Aura | `neo4j:5.26-community` | APOC plugin enabled, seed data via import volume |
| Azure AI Search | `opensearchproject/opensearch:2.17.0` | Supports BM25 + k-NN vector. Needs search adapter interface (`SEARCH_BACKEND=opensearch\|azure`) |
| Azure Blob Storage | `mcr.microsoft.com/azure-storage/azurite:3.33.0` | Official emulator, full SDK compatibility, zero code changes |

## Improvement Roadmap

### Phase 1 — Critical (Do Now)

1. Stand up `.devcontainer/` with Docker Compose (Neo4j, OpenSearch, Azurite, Keycloak)
2. Deploy `@neo4j/mcp-neo4j` in `.mcp.json` and verify Cypher queries through Claude Code
3. Create first plugin skill (Strategy Review) with graph-traversal sub-agent

### Phase 2 — Structural (Next Sprint)

4. Scaffold Next.js 15 web app with Keycloak auth and Claude API streaming
5. Refactor monolithic MCP server (split graph queries to Neo4j MCP Server)
6. Create Gender Tech and Budget review topic skills from the template

### Phase 3 — Optimisation (Backlog)

7. Add observability (OpenTelemetry + Grafana/Loki in Docker Compose)
8. Implement Redis caching for frequent graph traversals
9. Build CI/CD pipeline for plugin skill testing and Azure deployment
10. Index management tooling (Azure AI Search → OpenSearch schema sync)

## Architecture Diagram

View the interactive diagram: [claude-plugin-dev-architecture.html](claude-plugin-dev-architecture.html)
